name: Unity WebGL Build ğŸš€

on:
  push:
    branches:
      - main  # main ë¸Œëœì¹˜ì— pushë  ë•Œë§Œ ì‹¤í–‰

jobs:
  build:
    name: Build WebGL Project âœ¨
    runs-on: ubuntu-latest
    steps:
      # âœ… ë¦¬í¬ì§€í† ë¦¬ ì²´í¬ì•„ì›ƒ
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          lfs: true

      # âœ… Git LFS ê°•ì œ ë‹¤ìš´ë¡œë“œ (LFS ì˜¤ë¥˜ í•´ê²°)
      - name: Setup Git LFS
        run: |
          git lfs install
          git lfs pull

      # âœ… ê¸°ì¡´ Artifacts ì‚­ì œ (ì´ì „ ë¹Œë“œ ì‚­ì œ)
      - name: Delete old artifacts
        uses: geekyeggo/delete-artifact@v2
        with:
          name: WebGL-Build  # ê¸°ì¡´ ë¹Œë“œ íŒŒì¼ ì‚­ì œ

      # âœ… ìºì‹± (ì†ë„ ê°œì„ )
      - uses: actions/cache@v3
        with:
          path: Library
          key: Library-${{ hashFiles('Assets/**', 'Packages/**', 'ProjectSettings/**') }}
          restore-keys: |
            Library-

      # âœ… Unity WebGL ë¹Œë“œ ì‹¤í–‰
      - name: Build WebGL
        uses: game-ci/unity-builder@v4
        env:
          UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}  # ğŸ”¥ GitHub Secretsì—ì„œ ë¶ˆëŸ¬ì˜´
          UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
          UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
        with:
          targetPlatform: WebGL
          buildName: WebGLBuild
          outputPath: build  # ë¹Œë“œ ê²°ê³¼ í´ë”

      # âœ… ë¹Œë“œ íŒŒì¼ì„ ZIPìœ¼ë¡œ ì••ì¶• (ìš©ëŸ‰ ì ˆì•½)
      - name: Compress Build
        run: zip -r WebGLBuild.zip build/

      # âœ… GitHub Artifactsì— ì—…ë¡œë“œ (ë¹Œë“œ ê²°ê³¼ ì €ì¥)
      - uses: actions/upload-artifact@v4
        with:
          name: WebGL-Build
          path: WebGLBuild.zip  # ZIP íŒŒì¼ ì—…ë¡œë“œ
